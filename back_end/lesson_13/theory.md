## Задача

Хотим предоставить список всех пользователей, пользователю с ролью ADMIN

## Слоенная архитектура

![image](https://raw.githubusercontent.com/ait-tr/cohort22/main/back_end/lesson_13/img/3.png)

## Безопасность в приложении

![image](https://raw.githubusercontent.com/ait-tr/cohort22/main/back_end/lesson_13/img/1.png)

* Аутентификация - мы сообщаем приложению, кто мы такие.
* Авторизация - приложение проверяет, какие есть у нас права.

## Аутентификация на основе сессий

![image](https://raw.githubusercontent.com/ait-tr/cohort22/main/back_end/lesson_13/img/2.png)

Сессия - это специальный объект, который хранится на сервере и позволяет связать цепочку
разных HTTP-запросов между собой. Каждый запрос сопровождается идентификатором сессии. Сама сессия находится на сервере

1. Пользователь сообщает серверу свой логин и пароль
2. Если логин и пароль соответствуют какому-либо пользователю в базе
    - сервер создает объект сессии с данными этого пользователя и присваивает ей ID
    - сессия сохраняется в хранилище сессий
    - идентификатор сессии уходит через куки клиенту
3. Каждый следующий запрос клиент отправляет вместе с идентификатором сессии
4. Как только сервер получает запрос, он проверяет эту сессию в своем хранилище и принимает решение - давать доступ или нет

## Spring Security

* Фреймворк, в котором уже реализованы механизмы аутентификации и авторизации
* По умолчанию при подключении Spring Security создается "единственный временный пользователь" с логином "user" и сгенерированным паролем
* Далее, вы можете донастроить Spring Security под свои нужды

### Details

* Информация о данных пользователя (пароль, имя, роль и т.д.)
* `UserDetails` - интерфейс, который описывает объект, предоставляющий информацию о пользователе для Spring Security
* `Authority` - права пользователя = роль
* `getAuthorities()` - метод, который возвращает коллекцию прав пользователя.
* В нашем случае у пользователя только одно право = роль
* `UserDetailsService` - интерфейс, который получает объект `UserDetails` по его `username`
* В общих словах - этот сервис должен достать пользователя из базы данных по его имени

![image](https://raw.githubusercontent.com/ait-tr/cohort22/main/back_end/lesson_13/img/4.png)

### Общая логика сравнения пароля и его хеша

* Берем пароль, который ввел пользователь. Берем от него хеш и сравниваем с хешем, который лежит в базе